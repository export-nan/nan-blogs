import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as t,e as p}from"./app-ByLiKQ9I.js";const e={};function o(c,n){return a(),t("div",null,n[0]||(n[0]=[p(`<h2 id="threejs-3d-地图加载器" tabindex="-1"><a class="header-anchor" href="#threejs-3d-地图加载器" aria-hidden="true">#</a> Threejs 3d 地图加载器</h2><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// @ts-ignore</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">&#39;three&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// @ts-ignore</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> d3 <span class="token keyword">from</span> <span class="token string">&#39;d3&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span>Featuresjson<span class="token punctuation">,</span> Mapjson<span class="token punctuation">,</span> Coordinates<span class="token punctuation">,</span> Coordinate<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./map_package/type&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> geojsons <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./map_package/index&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> depth <span class="token operator">=</span> <span class="token number">3</span> <span class="token comment">// 设置模型的厚度</span>

<span class="token keyword">let</span> containerElement<span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span>
<span class="token keyword">let</span> screenBox<span class="token operator">:</span> HTMLElement<span class="token punctuation">;</span>
<span class="token keyword">const</span> mouse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Vector2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mouseRaycaster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Raycaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 事件点数组</span>
<span class="token keyword">let</span> eventPoint<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> EventPoint<span class="token operator">|</span><span class="token keyword">undefined</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// threejs 渲染器</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ThreeMap</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> renderer<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>WebGLRenderer<span class="token punctuation">;</span>
    <span class="token keyword">public</span> scene<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Scene<span class="token punctuation">;</span>
    <span class="token keyword">public</span> camera<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PerspectiveCamera<span class="token punctuation">;</span>
    <span class="token keyword">public</span> height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span>element<span class="token operator">:</span> HTMLElement<span class="token punctuation">)</span><span class="token punctuation">{</span>
        containerElement <span class="token operator">=</span> element<span class="token punctuation">;</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>width<span class="token punctuation">,</span> height<span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> width<span class="token punctuation">;</span>

        <span class="token comment">// 创建webGL渲染器</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">WebGLRenderer</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> antialias<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>alpha<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token comment">// 开启阴影</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>toneMapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>ACESFilmicToneMapping<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>toneMappingExposure <span class="token operator">=</span> <span class="token number">1.25</span><span class="token punctuation">;</span>   
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token number">0xffffff</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 场景</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 相机 透视相机</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span> width <span class="token operator">/</span> height<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">lookAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将渲染器注入到容器里</span>
        containerElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>domElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        containerElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Object</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onMouseMove</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        containerElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">Object</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onMouseClick</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resizeObserver<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>containerElement<span class="token punctuation">)</span>

        <span class="token comment">// 添加一个屏幕空间UI盒子 用来放置一些UI元素</span>
        screenBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span>
        screenBox<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&#39;absolute&#39;</span>
        screenBox<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">&#39;screen-space-ui&#39;</span>
        containerElement<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>screenBox<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 切换地图模型</span>
    <span class="token keyword">public</span> <span class="token function">switchMap</span><span class="token punctuation">(</span>mapName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 移除上一个地图对象</span>
        <span class="token keyword">const</span> current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>current<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            current<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>geojsons<span class="token punctuation">[</span>mapName<span class="token punctuation">]</span><span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;地图不存在&#39;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createMapModle</span><span class="token punctuation">(</span>geojsons<span class="token punctuation">[</span>mapName<span class="token punctuation">]</span><span class="token punctuation">)</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        eventPoint <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建地图模型</span>
    <span class="token keyword">private</span> mapModleRecord<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CreateMap<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> currentMapName<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token function">createMapModle</span><span class="token punctuation">(</span>mapJson<span class="token operator">:</span> Mapjson<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> MapModle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span>mapJson<span class="token punctuation">.</span>name<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>MapModle<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            MapModle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateMap</span><span class="token punctuation">(</span>mapJson<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span>mapJson<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> MapModle
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            MapModle<span class="token punctuation">.</span><span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName <span class="token operator">=</span> mapJson<span class="token punctuation">.</span>name
        <span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>MapModle<span class="token punctuation">.</span>Object3D <span class="token keyword">as</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取一个区块的中心点坐标</span>
    <span class="token keyword">private</span> <span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>featureName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>featureName<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 事件点</span>
    <span class="token function">setEventPoint</span><span class="token punctuation">(</span>data<span class="token operator">:</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> template<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> newEventPoint<span class="token operator">:</span>Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> EventPoint<span class="token operator">|</span><span class="token keyword">undefined</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token function-variable function">defaultTemplate</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
                    &lt;div class=&#39;point&#39;&gt;&lt;/div&gt;
                    &lt;div class=&#39;text&#39;&gt;
                        &lt;span class=&#39;name&#39;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
                        &lt;span class=&#39;value&#39;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;
                    &lt;/div&gt;
                </span><span class="token template-punctuation string">\`</span></span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> ponit <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateEventPoint</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>value<span class="token punctuation">,</span> template<span class="token operator">||</span>defaultTemplate<span class="token punctuation">)</span>
            newEventPoint<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> ponit
            eventPoint<span class="token punctuation">[</span>item<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
            item<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        eventPoint <span class="token operator">=</span> newEventPoint
    <span class="token punctuation">}</span>
    <span class="token comment">// 更新事件点</span>
    <span class="token keyword">public</span> <span class="token function">updateEventPoint</span><span class="token punctuation">(</span>featureName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token function-variable function">template</span><span class="token operator">:</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> dom <span class="token operator">=</span> eventPoint<span class="token punctuation">[</span>featureName<span class="token punctuation">]</span>
        <span class="token keyword">const</span> featureCenter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>featureName<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>featureCenter<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token keyword">undefined</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> featureCenter
        <span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toScreenPosition</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Vector3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>dom<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            dom<span class="token punctuation">.</span>value <span class="token operator">=</span> value
            dom<span class="token punctuation">.</span>x <span class="token operator">=</span> sp<span class="token punctuation">.</span>x
            dom<span class="token punctuation">.</span>y <span class="token operator">=</span> sp<span class="token punctuation">.</span>y
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventPoint</span><span class="token punctuation">(</span>sp<span class="token punctuation">.</span>x<span class="token punctuation">,</span> sp<span class="token punctuation">.</span>y<span class="token punctuation">,</span> featureName<span class="token punctuation">,</span> value<span class="token punctuation">,</span> template<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> dom
    <span class="token punctuation">}</span>
    <span class="token comment">// 获取所有事件点</span>
    <span class="token keyword">public</span> <span class="token function">getAllEventPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> EventPoint<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span>item<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">as</span> EventPoint<span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 渲染场景</span>
    <span class="token keyword">async</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 防抖</span>
    <span class="token keyword">private</span> debounce<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
    <span class="token keyword">private</span> intersectMap<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">private</span> <span class="token function">onMouseMove</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span>
        <span class="token comment">// 将鼠标位置转换为归一化设备坐标 (-1 到 +1)</span>
        <span class="token keyword">const</span> rect <span class="token operator">=</span> containerElement<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> mouseX <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> rect<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">const</span> mouseY <span class="token operator">=</span> event<span class="token punctuation">.</span>clientY <span class="token operator">-</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
        mouse<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token punctuation">(</span>mouseX <span class="token operator">/</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        mouse<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>mouseY <span class="token operator">/</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
        <span class="token comment">// 更新射线</span>
        mouseRaycaster<span class="token punctuation">.</span><span class="token function">setFromCamera</span><span class="token punctuation">(</span>mouse<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> intersectFeatures<span class="token operator">:</span>CreateFeature<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> activeFeatures<span class="token operator">:</span>CreateFeature<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>currentMap<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span>
        <span class="token keyword">const</span> features <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>currentMap<span class="token punctuation">.</span>features<span class="token punctuation">)</span>
        
        <span class="token keyword">const</span> intersectMap <span class="token operator">=</span> mouseRaycaster<span class="token punctuation">.</span><span class="token function">intersectObject</span><span class="token punctuation">(</span>currentMap<span class="token punctuation">.</span>Object3D <span class="token keyword">as</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>intersectMap<span class="token punctuation">.</span>length<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>intersectMap<span class="token punctuation">)</span><span class="token punctuation">{</span>
                features<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span>item<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>feature<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    feature<span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>intersectMap <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitMoveMouseEvent</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>intersectMap <span class="token operator">=</span> <span class="token boolean">true</span>
        
        features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>isActive<span class="token punctuation">)</span><span class="token punctuation">{</span>
                activeFeatures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>Object3D<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token keyword">return</span> 
            <span class="token keyword">const</span> inter <span class="token operator">=</span> mouseRaycaster<span class="token punctuation">.</span><span class="token function">intersectObject</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                intersectFeatures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debounce<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debounce<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debounce <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>debounce <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>intersectFeatures<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                activeFeatures<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item<span class="token operator">=&gt;</span>item<span class="token punctuation">.</span>name<span class="token operator">!==</span>intersectFeatures<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>feature<span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    feature<span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">false</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token keyword">const</span> feature <span class="token operator">=</span> intersectFeatures<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                feature<span class="token punctuation">.</span>isActive <span class="token operator">=</span> <span class="token boolean">true</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitMoveMouseEvent</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
                
            <span class="token punctuation">}</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debounce<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>debounce <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">number</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 监听鼠标点击事件</span>
    <span class="token keyword">private</span> <span class="token function">onMouseClick</span><span class="token punctuation">(</span>event<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span>

        <span class="token keyword">const</span> features <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>currentMap<span class="token punctuation">.</span>features<span class="token punctuation">)</span>
        <span class="token keyword">const</span> intersectFeatures<span class="token operator">:</span>CreateFeature<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>Object3D<span class="token operator">===</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token keyword">return</span> 
            <span class="token keyword">const</span> inter <span class="token operator">=</span> mouseRaycaster<span class="token punctuation">.</span><span class="token function">intersectObject</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>inter<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                intersectFeatures<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>intersectFeatures<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitClickMouseEvent</span><span class="token punctuation">(</span>intersectFeatures<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 监听鼠标移动事件</span>
    <span class="token keyword">private</span> moveMouseEventList<span class="token operator">:</span>Map<span class="token operator">&lt;</span><span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>that<span class="token operator">:</span> Object<span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token function">onMoveMouseEvent</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">,</span> that<span class="token operator">:</span> Object <span class="token operator">=</span> window<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moveMouseEventList<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span><span class="token punctuation">{</span>that<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">removeMoveMouseEvent</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moveMouseEventList<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token function">emitMoveMouseEvent</span><span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token operator">|</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>moveMouseEventList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>that<span class="token punctuation">)</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 监听鼠标点击事件</span>
    <span class="token keyword">private</span> mouseClickEventList<span class="token operator">:</span>Map<span class="token operator">&lt;</span><span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>that<span class="token operator">:</span> Object<span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token function">onClickMouseEvent</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">,</span> that<span class="token operator">:</span> Object <span class="token operator">=</span> window<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mouseClickEventList<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span><span class="token punctuation">{</span>that<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token function">removeClickMouseEvent</span><span class="token punctuation">(</span><span class="token function-variable function">callback</span><span class="token operator">:</span> <span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mouseClickEventList<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token function">emitClickMouseEvent</span><span class="token punctuation">(</span>feature<span class="token operator">:</span> CreateFeature<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mouseClickEventList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>that<span class="token punctuation">)</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 设置一个区块高亮状态</span>
    <span class="token function">setHighlightStatus</span><span class="token punctuation">(</span>featureName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> highlight<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>currentMap<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span>
        currentMap<span class="token punctuation">.</span><span class="token function">setHighlightStatus</span><span class="token punctuation">(</span>featureName<span class="token punctuation">,</span> highlight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">const</span> featureCentroid <span class="token operator">=</span> currentMap<span class="token punctuation">.</span><span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>featureName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>featureCentroid<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=</span> featureCentroid

        <span class="token keyword">const</span> p <span class="token operator">=</span> eventPoint<span class="token punctuation">[</span>featureName<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>p <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span>
        <span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toScreenPosition</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Vector3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>x <span class="token operator">=</span> sp<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>y <span class="token operator">=</span> sp<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 清空其他区域的高亮</span>
    <span class="token function">clearHighlight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> currentMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentMapName<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>currentMap<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>currentMap<span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setHighlightStatus</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">// 将 3D 坐标转换到屏幕空间坐标的函数</span>
    <span class="token function">toScreenPosition</span><span class="token punctuation">(</span>vec3<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Vector3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将世界坐标投影到相机的裁剪空间</span>
        vec3<span class="token punctuation">.</span><span class="token function">project</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 将裁剪空间坐标转换为屏幕空间坐标</span>
        <span class="token keyword">const</span> rect <span class="token operator">=</span> containerElement<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> halfWidth <span class="token operator">=</span> rect<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> halfHeight <span class="token operator">=</span> rect<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            x<span class="token operator">:</span> <span class="token punctuation">(</span>vec3<span class="token punctuation">.</span>x <span class="token operator">*</span> halfWidth<span class="token punctuation">)</span> <span class="token operator">+</span> halfWidth<span class="token punctuation">,</span>
            y<span class="token operator">:</span> <span class="token operator">-</span><span class="token punctuation">(</span>vec3<span class="token punctuation">.</span>y <span class="token operator">*</span> halfHeight<span class="token punctuation">)</span> <span class="token operator">+</span> halfHeight
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    resizeObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResizeObserver</span><span class="token punctuation">(</span>entries <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> entry <span class="token keyword">of</span> entries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> entry<span class="token punctuation">.</span>contentRect<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 更新地图的大小</span>
    <span class="token keyword">private</span> resizeDebounce<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
    <span class="token function">resize</span><span class="token punctuation">(</span>width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>width<span class="token operator">!==</span><span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token operator">||</span>height<span class="token operator">!==</span><span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>aspect <span class="token operator">=</span> width <span class="token operator">/</span> height<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAllEventPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    <span class="token keyword">const</span> featureCenter <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>featureCenter<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token keyword">return</span> <span class="token keyword">undefined</span>
                    <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> featureCenter
                    <span class="token keyword">const</span> sp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toScreenPosition</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Vector3</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    eventPoint<span class="token punctuation">.</span>x <span class="token operator">=</span> sp<span class="token punctuation">.</span>x
                    eventPoint<span class="token punctuation">.</span>y <span class="token operator">=</span> sp<span class="token punctuation">.</span>y
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>resizeDebounce <span class="token operator">=</span> <span class="token keyword">undefined</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">number</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 销毁整个地图</span>
    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mapModleRecord<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            map<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>eventPoint<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            eventPoint<span class="token operator">?.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 事件点虚拟dom</span>
<span class="token keyword">class</span> <span class="token class-name">EventPoint</span><span class="token punctuation">{</span>
    dom<span class="token operator">:</span> HTMLElement
    <span class="token function-variable function">template</span><span class="token operator">:</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">string</span>

    <span class="token keyword">private</span> _name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
    <span class="token keyword">set</span> <span class="token function">name</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_name <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">template</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_name
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> _value<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">set</span> <span class="token function">value</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">template</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_value
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> _x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">set</span> <span class="token function">x</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_x <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_x
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> _y<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">set</span> <span class="token function">y</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_y <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>top <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_y
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> _className<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_className<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">addClassNames</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_className<span class="token punctuation">[</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>className
    <span class="token punctuation">}</span>

    <span class="token function">removeClassNames</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_className<span class="token punctuation">[</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>className
    <span class="token punctuation">}</span>


    <span class="token function">constructor</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token function-variable function">template</span><span class="token operator">:</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>template <span class="token operator">=</span> template
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>style<span class="token punctuation">.</span>position <span class="token operator">=</span> <span class="token string">&#39;absolute&#39;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x
        <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addClassNames</span><span class="token punctuation">(</span><span class="token string">&#39;evnet-point&#39;</span><span class="token punctuation">)</span>
        screenBox<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dom<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token comment">// 创建地图 模型</span>
<span class="token keyword">class</span> <span class="token class-name">CreateMap</span><span class="token punctuation">{</span>
    Object3D<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token operator">|</span><span class="token keyword">null</span> <span class="token comment">// 地图的3D对象</span>
    
    <span class="token keyword">readonly</span> features<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> CreateFeature<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 区块</span>

    <span class="token keyword">private</span> projection<span class="token operator">:</span>d3<span class="token punctuation">.</span>GeoProjection<span class="token punctuation">;</span> <span class="token comment">// 墨卡托投影转换</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span>mapJson<span class="token operator">:</span> Mapjson<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> bbox <span class="token operator">=</span> mapJson<span class="token punctuation">.</span>bbox<span class="token punctuation">;</span>
        <span class="token keyword">const</span> offset <span class="token operator">=</span> mapJson<span class="token punctuation">.</span>offset<span class="token punctuation">;</span>
        <span class="token keyword">const</span> rect <span class="token operator">=</span> containerElement<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>projection <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoMercator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span>
            bbox<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token operator">?</span><span class="token punctuation">[</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">37.5</span><span class="token punctuation">]</span><span class="token operator">:</span>
            <span class="token punctuation">[</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>offset<span class="token operator">===</span><span class="token keyword">undefined</span><span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span><span class="token punctuation">[</span>offset<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> offset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bbox<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> bboxWidth <span class="token operator">=</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> bboxHeight <span class="token operator">=</span> bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> scale <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width <span class="token operator">/</span> bboxWidth<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>height <span class="token operator">/</span> bboxHeight<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>mapJson<span class="token punctuation">.</span>scale<span class="token operator">||</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>projection <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>projection<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span>features<span class="token punctuation">}</span> <span class="token operator">=</span> mapJson<span class="token punctuation">;</span>
        features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> Feature <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFeature</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">?.</span><span class="token function">add</span><span class="token punctuation">(</span>Feature<span class="token punctuation">.</span>Object3D <span class="token keyword">as</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 创建区块对象</span>
    <span class="token function">createFeature</span><span class="token punctuation">(</span>feature<span class="token operator">:</span> Featuresjson<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> area  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateFeature</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>projection <span class="token keyword">as</span> <span class="token punctuation">(</span>opt<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">[</span>feature<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> area
        <span class="token keyword">return</span> area
    <span class="token punctuation">}</span>

    <span class="token comment">// 获取一个区块的质心</span>
    <span class="token function">getFeatureCentroid</span><span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">|</span><span class="token keyword">undefined</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> feature <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>feature<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span>
        <span class="token keyword">const</span> centroid <span class="token operator">=</span> feature<span class="token operator">?.</span>centroid
        <span class="token keyword">const</span> depth <span class="token operator">=</span> feature<span class="token punctuation">.</span>depth
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>centroid<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> centroid
        <span class="token keyword">return</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> depth<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 设置一个区块高亮状态</span>
    <span class="token function">setHighlightStatus</span><span class="token punctuation">(</span>featureName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> highlight<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> feature <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">[</span>featureName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            feature<span class="token punctuation">.</span>isActive <span class="token operator">=</span> highlight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 销毁当前模型</span>
    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            feature<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">?.</span>parent<span class="token operator">?.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">===</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 重新构建</span>
    <span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>features<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> FeatureObject3D <span class="token operator">=</span> feature<span class="token punctuation">.</span><span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">?.</span><span class="token function">add</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>Object3D <span class="token keyword">as</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// 创建区块 模型</span>
<span class="token keyword">class</span> <span class="token class-name">CreateFeature</span><span class="token punctuation">{</span>
    Object3D<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Object3D<span class="token operator">|</span><span class="token keyword">null</span> <span class="token comment">// 区块的3D对象</span>

    name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token comment">// 区块的名称</span>
    center<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token comment">// 区块的中心点</span>
    centroid<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">]</span> <span class="token comment">// 质心点</span>

    is2d<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 区块是否为2D</span>
    shapes<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Shape<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 平面图形</span>
    geometrys<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>ExtrudeGeometry<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 立体模型</span>
    mesh<span class="token operator">:</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>Mesh<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 区块的网格模型</span>
    
    <span class="token keyword">private</span> _isActive<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// 区块是否被选中</span>
    <span class="token comment">// 区块是否被选中</span>
    <span class="token keyword">get</span> <span class="token function">isActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_isActive
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">isActive</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_isActive <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setHighlight</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scaleZ <span class="token operator">=</span> value<span class="token operator">?</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">1</span>
        <span class="token keyword">const</span> eventpoint <span class="token operator">=</span> eventPoint<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>eventpoint<span class="token operator">!==</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">{</span>
                eventpoint<span class="token punctuation">.</span><span class="token function">addClassNames</span><span class="token punctuation">(</span><span class="token string">&#39;active&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                eventpoint<span class="token punctuation">.</span><span class="token function">removeClassNames</span><span class="token punctuation">(</span><span class="token string">&#39;active&#39;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    _scaleZ<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// 区块的z轴拉伸</span>
    <span class="token keyword">get</span> <span class="token function">scaleZ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_scaleZ
    <span class="token punctuation">}</span>
    <span class="token keyword">set</span> <span class="token function">scaleZ</span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_scaleZ <span class="token operator">=</span> value
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateModelHeight</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">get</span> <span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> depth <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scaleZ
    <span class="token punctuation">}</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span>features<span class="token operator">:</span> Featuresjson<span class="token punctuation">,</span> <span class="token function-variable function">projection</span><span class="token operator">:</span><span class="token punctuation">(</span>opt<span class="token operator">:</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>name
        <span class="token keyword">this</span><span class="token punctuation">.</span>is2d <span class="token operator">=</span> features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>is2d <span class="token operator">||</span> <span class="token boolean">false</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>centroid <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>centroid<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>center <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>center<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateShapes</span><span class="token punctuation">(</span>features<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">,</span> projection<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateMesh</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>depth<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 生成区块的平面图</span>
    <span class="token function">generateShapes</span><span class="token punctuation">(</span>coordinates<span class="token operator">:</span> Coordinates<span class="token punctuation">,</span> <span class="token function-variable function">projection</span><span class="token operator">:</span><span class="token punctuation">(</span>opt<span class="token operator">:</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span><span class="token builtin">number</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> innerThis <span class="token operator">=</span> <span class="token keyword">this</span>

        <span class="token comment">// 用于递归coordinates数组</span>
        <span class="token keyword">function</span> <span class="token function">recursion</span><span class="token punctuation">(</span>coordinates<span class="token operator">:</span> Coordinates<span class="token punctuation">)</span><span class="token punctuation">{</span>
            coordinates<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> Coordinates<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">buildMesh</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> Coordinate<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token function">recursion</span><span class="token punctuation">(</span>item <span class="token keyword">as</span> Coordinates<span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 用来构建模型</span>
        <span class="token keyword">function</span> <span class="token function">buildMesh</span><span class="token punctuation">(</span>coordinates<span class="token operator">:</span> Coordinate<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> shape <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Shape</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            innerThis<span class="token punctuation">.</span>shapes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 绘制平面图形</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> coordinates<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> <span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">projection</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    shape<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                shape<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">-</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">recursion</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 生成区块的冲压模型</span>
    <span class="token function">generateMesh</span><span class="token punctuation">(</span>depth<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleasMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">const</span> innerThis <span class="token operator">=</span> <span class="token keyword">this</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>shapes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">ExtrudeGeometry</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                depth<span class="token operator">:</span> innerThis<span class="token punctuation">.</span>is2d<span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> depth <span class="token punctuation">,</span> <span class="token comment">// 模型的深度</span>
                bevelEnabled<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 对挤出的形状应用是否斜角</span>
                bevelSegments<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 斜角的分段层数</span>
                bevelThickness<span class="token operator">:</span> <span class="token number">0.2</span> <span class="token comment">// 设置原始形状上斜角的厚度。</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>geometrys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span>
            <span class="token comment">// 创建网格对象</span>
            <span class="token keyword">const</span> mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Mesh</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> <span class="token punctuation">[</span>
                innerThis<span class="token punctuation">.</span>topMaterial<span class="token punctuation">,</span>
                innerThis<span class="token punctuation">.</span>verticalMaterial<span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span>
            <span class="token comment">// 为模型添加描边</span>
            <span class="token comment">// TODO 性能差，耗时太多，需要优化</span>
            <span class="token keyword">const</span> edges <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">EdgesGeometry</span><span class="token punctuation">(</span> geometry <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> line <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">LineSegments</span><span class="token punctuation">(</span> edges<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">LineBasicMaterial</span><span class="token punctuation">(</span> <span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token number">0xffffff</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            mesh<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> line <span class="token punctuation">)</span><span class="token punctuation">;</span>

            innerThis<span class="token punctuation">.</span>Object3D<span class="token operator">?.</span><span class="token function">add</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> topMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">ShaderMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        uniforms<span class="token operator">:</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span> <span class="token number">0x62797a</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        fragmentShader<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
            uniform vec3 color;
            void main() {
                gl_FragColor = vec4( color, 1.0 );
            }
        </span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> verticalMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">ShaderMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        uniforms<span class="token operator">:</span> <span class="token punctuation">{</span>
            color<span class="token operator">:</span> <span class="token punctuation">{</span> value<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span> <span class="token number">0x62797a</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        fragmentShader<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
            uniform vec3 color;
            void main() {
                gl_FragColor = vec4( color, 1.0 );
            }
        </span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">setHighlight</span><span class="token punctuation">(</span>isHighlight<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>isHighlight<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>topMaterial<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>color<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0x36c793</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>verticalMaterial<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>color<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0x36c793</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>topMaterial<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>color<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0x62797a</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>verticalMaterial<span class="token punctuation">.</span>uniforms<span class="token punctuation">.</span>color<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Color</span><span class="token punctuation">(</span><span class="token number">0x62797a</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 跟新模型的高度</span>
    <span class="token function">updateModelHeight</span><span class="token punctuation">(</span>newHeight<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>mesh <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            mesh<span class="token punctuation">.</span>scale<span class="token punctuation">.</span>z <span class="token operator">=</span> newHeight
            mesh<span class="token punctuation">.</span><span class="token function">updateMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">cleasMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>geometrys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>geometry <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            geometry<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>geometrys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>mesh <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">?.</span><span class="token function">remove</span><span class="token punctuation">(</span>mesh<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 销毁当前区块</span>
    <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cleasMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">?.</span>parent<span class="token operator">?.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span>

    <span class="token function">rebuild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Object3D<span class="token operator">!==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>Object3D <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">THREE</span></span><span class="token punctuation">.</span><span class="token function">Object3D</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">generateMesh</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2)]))}const u=s(e,[["render",o],["__file","3dMap.html.vue"]]);export{u as default};
